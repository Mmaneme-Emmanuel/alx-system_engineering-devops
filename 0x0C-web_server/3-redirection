#!/usr/bin/env bash

# Step 1: Install Nginx
if ! command -v nginx &> /dev/null; then
    echo "Installing Nginx..."
    sudo apt update
    sudo apt install -y nginx
else
    echo "Nginx is already installed."
fi

# Step 2: Configure redirection
config_file="/etc/nginx/sites-available/default"
backup_file="/etc/nginx/sites-available/default.bak"
redirect_config="
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    server_name _;

    location /redirect_me {
        return 301 https://example.com/new_page;
    }

    # Other server configurations...
}
"

# Backup the original config file
if [[ ! -f "$backup_file" ]]; then
    sudo cp "$config_file" "$backup_file"
fi

# Apply redirection configuration
sudo sed -i '/^\s*server {/a \
'"$redirect_config"'
' "$config_file"

# Test Nginx configuration
sudo nginx -t

# Reload Nginx to apply changes
sudo systemctl reload nginx

echo "Redirection configured successfully."
